<template>
  <div id="mobile-store-nudge">
    <h2 style="font-weight: 500; line-height: 1.5em;">
      Eine Schweizer App <br /><strong>für nachhaltige Ernährung</strong>
    </h2>
    <a href="https://play.google.com/store/apps/details?id=eatable.app" target="_blank">
      <svg
        id="play-store-badge"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        viewBox="0 0 151.21 51.95"
      >
        <defs>
          <linearGradient
            id="Unbenannter_Verlauf_5"
            data-name="Unbenannter Verlauf 5"
            x1="2317.34"
            y1="-2888.68"
            x2="2317.39"
            y2="-2888.68"
            gradientTransform="matrix(0, 400, 278, 0, 803075.57, -926915.66)"
            gradientUnits="userSpaceOnUse"
          >
            <stop offset="0" stop-color="#3588b7" />
            <stop offset="1" stop-color="#66ffd4" />
          </linearGradient>
          <linearGradient
            id="Unbenannter_Verlauf_2"
            data-name="Unbenannter Verlauf 2"
            x1="2299.25"
            y1="-2894.74"
            x2="2299.3"
            y2="-2894.74"
            gradientTransform="matrix(264, 0, 0, -214.25, -606987.29, -620162.44)"
            gradientUnits="userSpaceOnUse"
          >
            <stop offset="0" stop-color="#9635c2" />
            <stop offset="1" stop-color="#e3424f" />
          </linearGradient>
          <linearGradient
            id="Unbenannter_Verlauf_3"
            data-name="Unbenannter Verlauf 3"
            x1="2299.17"
            y1="-2895.67"
            x2="2299.23"
            y2="-2895.67"
            gradientTransform="matrix(262, 0, 0, -212.97, -602368.63, -616653.81)"
            gradientUnits="userSpaceOnUse"
          >
            <stop offset="0" stop-color="#60cab6" />
            <stop offset="1" stop-color="#d6ffa2" />
          </linearGradient>
          <linearGradient
            id="Unbenannter_Verlauf_4"
            data-name="Unbenannter Verlauf 4"
            x1="2314.87"
            y1="-2908.98"
            x2="2314.92"
            y2="-2908.98"
            gradientTransform="matrix(116.67, 92.63, 116.67, -92.63, 69342.17, -483863.71)"
            gradientUnits="userSpaceOnUse"
          >
            <stop offset="0" stop-color="#ff9877" />
            <stop offset="1" stop-color="#ffc466" />
          </linearGradient>
        </defs>
        <g id="Ebene_2" data-name="Ebene 2">
          <g id="Ebene_1-2" data-name="Ebene 1">
            <g>
              <rect fill="#f2e9da" width="151.21" height="51.95" rx="24.74" />
              <g>
                <path
                  class="cls-2"
                  d="M29,29.58,15.06,40.11a1.31,1.31,0,0,1-.74-1.31V20.41A1.32,1.32,0,0,1,15.11,19Z"
                />
                <path class="cls-3" d="M29,33.06,16.27,40a1.47,1.47,0,0,1-1.21.15L26.17,28.89Z" />
                <path class="cls-4" d="M15.11,19a1.4,1.4,0,0,1,1.16.22l12.64,6.9-2.79,4.05Z" />
                <path class="cls-5" d="M28.91,26.16l4.48,2.42c1,.58,1,1.47,0,2.05L29,33.06l-3.48-3.48Z" />
                <path
                  d="M70.73,17.25A3.16,3.16,0,0,0,74,14a3.22,3.22,0,1,0-3.22,3.21Zm0-.73A2.39,2.39,0,0,1,68.36,14a2.44,2.44,0,0,1,2.37-2.53A2.48,2.48,0,0,1,73.16,14,2.44,2.44,0,0,1,70.73,16.52ZM70,36.16a4.66,4.66,0,1,0-4.69-4.63A4.59,4.59,0,0,0,70,36.16Zm0-1.84a2.83,2.83,0,0,1,0-5.64,2.64,2.64,0,0,1,2.63,2.85A2.71,2.71,0,0,1,70,34.32ZM82.64,35v.79c0,1.69-.84,2.69-2.48,2.69a2.45,2.45,0,0,1-2.31-1.63l-1.8.74a4.43,4.43,0,0,0,4.11,2.73c2.85,0,4.43-1.84,4.43-4.84V27.16h-2V28a3.23,3.23,0,0,0-2.48-1.11,4.66,4.66,0,0,0,0,9.32A2.88,2.88,0,0,0,82.64,35Zm54.25-8.21c0-.06-2.42-.06-2.42-.06L132,33l-2.68-6.22-2.32.06,3.9,8.79-2.16,4.59H131ZM124,34.69h.1V36h2.06V30.42c0-2.84-2-4.21-4.43-4.21a4,4,0,0,0-3.84,2.16l1.79.84a2.23,2.23,0,0,1,2-1.11,2.15,2.15,0,0,1,2.32,2.06c-1.68-.95-6.48-.69-6.48,2.79,0,2.58,2.58,3.32,3.58,3.32A3.12,3.12,0,0,0,124,34.69ZM94,36.16a4.7,4.7,0,0,0,3.89-2l-1.63-1A2.54,2.54,0,0,1,94,34.32a2.41,2.41,0,0,1-2.27-1.42L98,30.32c-.58-1.74-1.9-3.48-4.16-3.48a4.45,4.45,0,0,0-4.43,4.69A4.54,4.54,0,0,0,94,36.16Zm-34.24,0a4.66,4.66,0,1,0-4.69-4.63A4.59,4.59,0,0,0,59.78,36.16Zm-12.27,0c4.21,0,7.37-3.16,6.63-7.9H47.51v2h4.68c-.26,2.48-2.1,3.9-4.68,3.9a5.24,5.24,0,0,1,0-10.48A4.94,4.94,0,0,1,51,25.1l1.42-1.42a7.32,7.32,0,0,0-5-2A7.41,7.41,0,0,0,40.13,29,7.33,7.33,0,0,0,47.51,36.16ZM115.93,36V22.36h-2.06V36Zm-8.22-13.59H103V36h2V30.69h2.69a4.17,4.17,0,1,0,0-8.33ZM88.22,35.9V22.21h-2V35.9Zm-7.9-1.58a2.63,2.63,0,0,1-2.58-2.79,2.65,2.65,0,0,1,2.58-2.85,2.58,2.58,0,0,1,2.48,2.85A2.58,2.58,0,0,1,80.32,34.32Zm-20.54,0a2.83,2.83,0,0,1,0-5.64,2.64,2.64,0,0,1,2.63,2.85A2.71,2.71,0,0,1,59.78,34.32Zm61.68-.11c-.74,0-1.69-.31-1.69-1.21,0-1.89,3.43-1.89,4.37-1A2.9,2.9,0,0,1,121.46,34.21ZM91.38,31.37a2.64,2.64,0,0,1,2.48-2.74,1.94,1.94,0,0,1,1.74,1Zm16.38-7A2.22,2.22,0,0,1,110,26.52a2.14,2.14,0,0,1-2.22,2.16H105V24.36ZM47,13.83H44v.74h2.26A2.09,2.09,0,0,1,44,16.52a2.51,2.51,0,0,1,0-5,2.16,2.16,0,0,1,1.74.74l.52-.53A2.8,2.8,0,0,0,44,10.78a3.24,3.24,0,0,0,0,6.47A2.93,2.93,0,0,0,47,13.83Zm28.66,3.32V12l3.16,5.11h.84V10.93H78.9v3.64l0,1.21h0l-3-4.85h-1v6.22ZM65.26,11.67v-.74H61v.74h1.74v5.48h.79V11.67Zm-5.11,5.48V10.93h-.79v6.22Zm-3.53-5.48v-.74H52.35v.74h1.74v5.48h.79V11.67Zm-4.95,0v-.74H48v6.22h3.64v-.79H48.82V14.41H51.4v-.74H48.82v-2Z"
                />
              </g>
            </g>
          </g>
        </g>
      </svg>
    </a>
    <a href="https://testflight.apple.com/join/aJRTuAoF" target="_blank">
      <svg id="app-store-badge" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 151.21 51.95">
        <g id="Ebene_2" data-name="Ebene 2">
          <g id="Ebene_1-2" data-name="Ebene 1">
            <g>
              <rect fill="#f2e9da" width="151.21" height="51.95" rx="24.74" />
              <path
                d="M73.2,15.27a1.07,1.07,0,0,1,1.09-1.09c1,0,1,1.15,1,1.15v3h1.1v-3s.05-2.09-1.72-2.09a1.73,1.73,0,0,0-1.57.89l0-.79h-1l0,1.41V18.3h1.1Zm49.37,0a1.07,1.07,0,0,1,1.09-1.09c1,0,1,1.15,1,1.15v3h1.1v-3s0-2.09-1.72-2.09a1.48,1.48,0,0,0-1.46.89v-3h-1.1v7.2h1.1ZM79.77,37.35c5.9,0,5.9-10.44.31-10.44a3.75,3.75,0,0,0-3.44,1.88l-.1-1.67h-2l.11,2.25V41.21H76.9V35.94A3.05,3.05,0,0,0,79.77,37.35Zm-.42-8.66c3.5,0,3.5,6.94,0,6.94a2.43,2.43,0,0,1-2.4-2.45V31.35S77,28.69,79.35,28.69ZM62.5,15.8a2.41,2.41,0,1,0-4.8,0A2.41,2.41,0,1,0,62.5,15.8Zm-1.15,0c0,2.4-2.56,2.45-2.56,0S61.35,13.45,61.35,15.8Zm24.48,0a2.41,2.41,0,1,0-4.81,0A2.41,2.41,0,1,0,85.83,15.8Zm-1.15,0c0,2.4-2.56,2.45-2.56,0S84.68,13.45,84.68,15.8Zm24.73-.53a1.07,1.07,0,0,1,1.1-1.09c1,0,1,1.15,1,1.15v3h1.1v-3s.05-2.09-1.72-2.09a1.73,1.73,0,0,0-1.57.89l0-.79h-1l0,1.41V18.3h1.09ZM39.53,19.82a6.49,6.49,0,0,0-5.27-2.67c-2,0-3.65,1.26-4.69,1.26-1.26,0-2.4-1.15-4.44-1.15-3.91,0-7.15,3.7-6.52,9.34.57,5.06,4.17,10.8,6.83,10.8,1.67,0,2.4-1.09,4.44-1.09s2.61,1,4.38,1c3,0,5.43-5.27,6-7A5.88,5.88,0,0,1,39.53,19.82Zm-4.85-9.09a5.92,5.92,0,0,0-5.32,6.16C32.44,17,35,13.87,34.68,10.73ZM61.19,37.14,56.7,23.26H53.94L49.45,37.14h2.3L53,33.07h4.54l1.25,4.07Zm-4.07-5.79h-3.7l1.82-6.11Zm11.12,6c5.9,0,5.9-10.44.31-10.44a3.73,3.73,0,0,0-3.44,1.88L65,27.12H63l.1,2.4V41.21h2.25V35.94A3.05,3.05,0,0,0,68.24,37.35Zm-.42-8.66c3.55,0,3.55,6.94,0,6.94a2.43,2.43,0,0,1-2.4-2.45V31.35S65.42,28.69,67.82,28.69Zm24.27,8.66c2.87,0,5-1.41,5-4.12,0-2.19-1.57-3.29-3.5-4.07-1.25-.53-2.66-1.05-2.66-2.46,0-1.2,1.1-1.82,2.4-1.82A6.16,6.16,0,0,1,96,25.5l.58-1.77a6.7,6.7,0,0,0-3.19-.68c-2.55,0-4.69,1.46-4.69,3.91,0,1.73,1.2,3.08,3.65,4,1.36.47,2.5,1.1,2.5,2.51s-1.14,2.08-2.66,2.08A5.93,5.93,0,0,1,89,34.64l-.52,1.82A6,6,0,0,0,92.09,37.35Zm7.72-3.5c0,2.25.78,3.5,2.82,3.5a4.83,4.83,0,0,0,1.72-.26l0-1.67a4.72,4.72,0,0,1-1,.1c-.89,0-1.31-.62-1.31-1.87V28.79h2.46V27.12H102v-2.5l-2.19.67v1.83H98.35v1.67h1.46Zm15.71-1.77c0-6.94-9.81-7-9.81.16C105.71,39.18,115.52,39.07,115.52,32.08Zm-2.3.05c0,4.8-5.27,4.86-5.27,0S113.22,27.33,113.22,32.13Zm6.48-.52S119.75,29,122,29a4.78,4.78,0,0,1,.68.05V27a4.12,4.12,0,0,0-.52-.05,3,3,0,0,0-2.77,2.25l-.1-2H117.4l0,2.14v7.88h2.25Zm9.08,5.74a9,9,0,0,0,3.34-.63l-.32-1.56a6.83,6.83,0,0,1-2.71.47,2.84,2.84,0,0,1-3.13-3h6.68c.31-3.13-.94-5.74-4.12-5.74-3.4,0-4.7,3-4.7,5.33C123.82,35,125.33,37.35,128.78,37.35ZM126,31.09c0-.52.52-2.66,2.4-2.66,2.35,0,2.19,2.66,2.19,2.66ZM56.39,14.7c0-2.19-1.36-3.29-3.7-3.29a11,11,0,0,0-1.88.16v6.68s.94.1,1.56.1C54.88,18.35,56.39,17.15,56.39,14.7Zm-1.15.05a2.4,2.4,0,0,1-2.61,2.72,4.53,4.53,0,0,1-.78-.06V12.35s.52,0,.89,0A2.2,2.2,0,0,1,55.24,14.75Zm15.45-1.41h-1l-1,3.92-1-3.92h-.89l-1.14,3.92-.89-3.92h-1.1l1.46,5h1l1-3.65,1,3.65h1.05Zm7.62,5h1.1V11.1h-1.1Zm8.77-1.36c0,1.62,2.14,1.94,3,.79l.11.57h1L91,17.36V15.27c0-1.35-.62-2-1.93-2a3.21,3.21,0,0,0-1.67.42l.21.73A2.23,2.23,0,0,1,89,14c.73,0,1,.37,1,1.1C88.49,15.07,87.08,15.59,87.08,16.94Zm1.09-.1c0-1.2,1.83-1,1.83-1v.73C90,17.73,88.17,18,88.17,16.84Zm6.53,1.57a1.68,1.68,0,0,0,1.62-.89l.05.78h1s0-.73,0-1.36V11.1h-1.1v2.82a1.55,1.55,0,0,0-1.41-.68C92,13.24,91.88,18.41,94.7,18.41Zm.36-4.28c1.15,0,1.15,1.25,1.15,1.25v.83s0,1.31-1.2,1.31C93.34,17.52,93.24,14.13,95.06,14.13ZM106.7,15.8a2.41,2.41,0,1,0-4.8,0A2.41,2.41,0,1,0,106.7,15.8Zm-1.15,0c0,2.4-2.55,2.45-2.55,0S105.55,13.45,105.55,15.8Zm12.11.88c0,1.05.42,1.73,1.36,1.73a1.81,1.81,0,0,0,.88-.16l-.05-.84a1.39,1.39,0,0,1-.47.06c-.41,0-.62-.26-.62-.89v-2.4H120v-.84h-1.2v-1.2l-1.1.32v.88h-.73v.84h.73Zm12.11,1.67a4.76,4.76,0,0,0,1.67-.26l-.16-.78a3.32,3.32,0,0,1-1.36.21,1.39,1.39,0,0,1-1.56-1.41h3.29a2.22,2.22,0,0,0-2-2.87,2.44,2.44,0,0,0-2.34,2.66A2.26,2.26,0,0,0,129.77,18.35Zm-1.41-3s.1-1.31,1.2-1.31,1.1,1.31,1.1,1.31Z"
              />
            </g>
          </g>
        </g>
      </svg>
    </a>
  </div>
  <ion-app>
    <p v-if="userOffline" id="user-offline-prompt">Du bist zur Zeit offline.<br />App-Funktionen sind eingeschränkt.</p>
    <ion-router-outlet />
  </ion-app>
</template>

<script lang="ts">
import { IonApp, IonRouterOutlet, isPlatform } from '@ionic/vue';
import { defineComponent } from 'vue';
import router from '@/router';
import { Network } from '@capacitor/network';

export default defineComponent({
  name: 'App',
  components: {
    IonApp,
    IonRouterOutlet,
  },
  data() {
    return {
      userOffline: false,
    };
  },
  mounted() {
    /* check for onboarding */
    if (!isPlatform('desktop') && !isPlatform('mobileweb')) {
      this.onboardingCheck();
    }

    /* check for network status */
    this.updateCurrentNetworkStatus();

    Network.addListener('networkStatusChange', () => {
      this.updateCurrentNetworkStatus();
    });
  },
  methods: {
    onboardingCheck() {
      this.$eatableStorage
        .get('onboarding')
        .then((res: string) => {
          if (res !== 'completed') {
            router.push('/onboarding');
          }
        })
        .catch(error => {
          console.error(error);
        });
    },
    async updateCurrentNetworkStatus() {
      const status = await Network.getStatus();
      this.userOffline = !status.connected;
    },
  },
});
</script>
<style scoped>
#user-offline-prompt {
  position: fixed;
  width: 80%;
  margin: 64px 10%;
  z-index: 11;
  padding: 16px 24px 12px 24px;
  border-radius: 8px;
  color: var(--ion-card-background);
  background-color: rgb(var(--ion-color-primary-rgb), 0.95);
  text-align: center;
  line-height: 1.5em;
  font-size: 14px;
  box-shadow: 0 12px 16px 16px rgb(var(--ion-color-primary-rgb), 0.25);
}

/* desktop phone view */
html.plt-desktop ion-app.ion-page {
  max-width: 400px;
  margin: 16px auto;
  max-height: calc(100vh - 116px);
  height: 100%;
  box-shadow: 0px 6px 24px rgb(0 0 0 / 64%);
  border: 1px solid black;
}

/* mobile store links */
html:not(.plt-desktop) div#mobile-store-nudge {
  display: none;
  opacity: 0;
  visibility: hidden;
  height: 0;
}
html.plt-desktop div#mobile-store-nudge {
  position: absolute;
  left: 50%;
  bottom: 96px;
  width: 360px;
  padding: 0 36px;
  color: #fff9ee;
  transform: translateX(200px);
}
html.plt-desktop div#mobile-store-nudge h2 {
  font-size: 20px;
  line-height: 1.4em;
  margin-bottom: 16px;
}
html.plt-desktop div#mobile-store-nudge svg {
  display: inline-block;
  max-height: 40px;
  margin-right: 16px;
}

/* media queries */
@media screen and (max-height: 632px) {
  html.plt-desktop ion-app.ion-page {
    margin: auto;
    max-height: 100%;
  }
  html.plt-desktop body div#mobile-store-nudge {
    bottom: 30px;
  }
}
@media screen and (min-width: 801px) and (max-width: 1079px) {
  html.plt-desktop ion-app.ion-page {
    margin: 16px 360px 16px auto;
  }
  html.plt-desktop body div#mobile-store-nudge {
    left: auto;
    right: 0;
    transform: translateX(0);
  }
}
@media screen and (max-width: 800px) and (min-height: 633px) {
  html.plt-desktop body div#mobile-store-nudge {
    width: 100%;
    bottom: 12px;
    transform: translateX(-50%);
    text-align: center;
  }
  html.plt-desktop body div#mobile-store-nudge h2 {
    font-size: 16px;
    margin-bottom: 8px;
  }
  html.plt-desktop div#mobile-store-nudge h2 br {
    display: none;
  }
  html.plt-desktop body div#mobile-store-nudge svg {
    max-height: 32px;
  }
}
@media screen and (max-width: 800px) and (max-height: 632px) {
  html.plt-desktop div#mobile-store-nudge {
    display: none;
  }
}
</style>